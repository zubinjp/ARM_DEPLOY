{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "apiVersion": "2022-03-01",
  "location": "[resourceGroup().location]",
  "sku": {
    "name": "Standard_B1s",
    "tier": "Standard",
    "capacity": 2
  },
  "properties": {
    "upgradePolicy": {
      "mode": "Automatic"
    },
    "virtualMachineProfile": {
      "osProfile": {
        "computerNamePrefix": "myVMSS",
        "adminUsername": "[parameters('adminUsername')]",
        "adminPassword": "[parameters('adminPassword')]"
      },
      "storageProfile": {
        "osDisk": {
          "createOption": "FromImage",
          "managedDisk": {
            "storageAccountType": "Standard_LRS"
          }
        },
        "imageReference": {
          "publisher": "MicrosoftWindowsServer",
          "offer": "WindowsServer",
          "sku": "2019-Datacenter",
          "version": "latest"
        }
      },
      "networkProfile": {
        "networkInterfaceConfigurations": [
          {
            "name": "myNICConfig",
            "properties": {
              "primary": true,
              "ipConfigurations": [
                {
                  "name": "ipconfig1",
                  "properties": {
                    "subnet": {
                      "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', 'myVNet', 'default')]"
                    },
                    "publicIPAddressConfiguration": {
                      "name": "publicIP",
                      "properties": {
                        "publicIPAllocationMethod": "Dynamic"
                      }
                    }
                  }
                }
              ],
              "networkSecurityGroup": {
                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', 'myNSG')]"
              }
            }
          }
        ]
      }
    }
  },
  "name": "myVMSS",
  "dependsOn": [
    "[resourceId('Microsoft.Network/virtualNetworks', 'myVNet')]",
    "[resourceId('Microsoft.Network/networkSecurityGroups', 'myNSG')]"
  ]
}
